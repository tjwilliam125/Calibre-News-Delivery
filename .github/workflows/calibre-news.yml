name: Daily News to Drive

# TRIGGERS
on:
  workflow_dispatch:
  schedule:
    # 6:00 AM CDT (UTC-5) = 11:00 UTC
    - cron: '0 11 * * *'

jobs:
  fetch-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install Calibre
      run: |
        sudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.sh | sudo sh /dev/stdin

    # STEP 3: Fetch Financial Times, Atlantic, Guardian, New Yorker
    # Note: I have added --username and --password flags for the paywalled sites.
    # You must add these secrets in GitHub Settings, or remove those flags if you don't have accounts.
    - name: Fetch and Convert News
      run: |
        ebook-convert "Financial Times.recipe" "FT.epub" --output-profile=tablet --username="${{ secrets.FT_USERNAME }}" --password="${{ secrets.FT_PASSWORD }}" || true
        ebook-convert "The Atlantic.recipe" "Atlantic.epub" --output-profile=tablet --username="${{ secrets.ATLANTIC_USERNAME }}" --password="${{ secrets.ATLANTIC_PASSWORD }}" || true
        ebook-convert "The New Yorker.recipe" "NewYorker.epub" --output-profile=tablet --username="${{ secrets.NY_USERNAME }}" --password="${{ secrets.NY_PASSWORD }}" || true
        ebook-convert "The Guardian and Observer.recipe" "Guardian.epub" --output-profile=tablet || true

    # STEP 4: Upload All Epubs
    - name: Upload to Google Drive
      uses: adityak74/google-drive-upload-git-action@main
      with:
        credentials: ${{ secrets.DRIVE_CREDENTIALS }}
        filename: "*.epub"
        folderId: ${{ secrets.DRIVE_FOLDER_ID }}
        overwrite: "true"
